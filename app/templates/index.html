{% extends "base.html" %}

{% block content %}

<div class="sortfilter-bar">
		<!-- EUR (currency list dropdown) -->
		<ul>

		<li class="sortfilter-bar--currency">
			{{ currency_form.currency(class_="button") }}
		</li>

		<!-- Mobile sortby -->
		<li class="sortfilter-bar--sortby hide-on-desktop">
			<select name="sort_by" class="js-sort-by js-mobile-sort-by">
    			<optgroup label="General">
    				<option selected value="time">Newest</option>
	    			<option value="cost">Cost</option>
    			</optgroup>
    			<optgroup label="Routes">
					<option value="total_routes">Total # of routes</option>
					<option value="total_sport"># of sport routes</option>
					<option value="total_trad"># of traditional routes</option>
					<option value="total_boulders"># of boulder problems</option>
					<option value="easy_routes"># of easy routes</option>
					<option value="intermediate_routes"># of intermediate routes</option>
					<option value="hard_routes"># of hard routes</option>
					<option value="very_hard_routes"># of very hard routes</option>
    			</optgroup>
    		</select>
    		<a class="sortfilter-bar--asc-desc js-sortby-asc-desc js-mobile-sortby-asc-desc js-asc" href="javascript:void(0);">&uarr;</a>
		</li>

		<!-- Desktop filters -->
		<li class="sortfilter-bar--sortby hide-on-mobile">
			<select name="sort_by" class="js-sort-by js-desktop-sort-by">
    			<optgroup label="General">
    				<option selected value="time">Newest</option>
	    			<option value="cost">Cost</option>
    			</optgroup>
    			<optgroup label="Routes">
					<option value="total_routes">Total # of routes</option>
					<option value="total_sport"># of sport routes</option>
					<option value="total_trad"># of traditional routes</option>
					<option value="total_boulders"># of boulder problems</option>
					<option value="easy_routes"># of easy routes</option>
					<option value="intermediate_routes"># of intermediate routes</option>
					<option value="hard_routes"># of hard routes</option>
					<option value="very_hard_routes"># of very hard routes</option>
    			</optgroup>
    		</select>
    		<a class="sortfilter-bar--asc-desc js-sortby-asc-desc js-desktop-sortby-asc-desc js-asc" href="javascript:void(0);">&uarr;</a>
		</li>

		<li class="sortfilter-bar--cost button-filter hide-on-mobile">
			Cost
			<select name="filter-desktop-cost" class="js-filter-desktop-cost">
    			<option value="any">Any</option>
    			<option value="200">&#60;200 EUR / week</option>
    			<option value="500">&#60;500 EUR / week</option>
    			<option value="1000">&#60;1000 EUR / week</option>
    		</select>
		</li>

		<li class="sortfilter-bar--accomodation button-filter js-filter-button-dropdown hide-on-mobile">
			Accomodation
			<div class="dropdown-content">
				<input type="checkbox" class="js-filter-desktop-accomodation-checkbox" value="tent_free"> Free tent spots <br>
				<input type="checkbox" class="js-filter-desktop-accomodation-checkbox" value="van_free"> Free van spots <br>
				<input type="checkbox" class="js-filter-desktop-accomodation-checkbox" value="camping"> Camping <br>
				<input type="checkbox" class="js-filter-desktop-accomodation-checkbox" value="hostel"> Hostel/Guesthouse <br>
				<input type="checkbox" class="js-filter-desktop-accomodation-checkbox" value="apartment"> Apartment <br>
				<input type="checkbox" class="js-filter-desktop-accomodation-checkbox" value="house"> House <br>
				<input type="checkbox" class="js-filter-desktop-accomodation-checkbox" value="hotel"> Hotel <br>

				<input type="submit" class="js-filter-desktop-submit js-filter-desktop-accomodation-submit" value="GO">
			</div>
		</li>

		<li class="sortfilter-bar--discipline button-filter js-filter-button-dropdown hide-on-mobile">
			Discipline
			<div class="dropdown-content">
				<label for="filter-main-discipline">Main discipline</label>
				<select class="js-filter-desktop-main-discipline">
					<option selected value="any">Any</option>
					<option value="sport">Sport</option>
					<option value="traditional">Trad</option>
					<option value="bouldering">Bouldering</option>
				</select>
				<label>Also has</label>
				<input type="checkbox" class="js-filter-desktop-second-discipline-checkbox" value="sport"> Sport<br>
				<input type="checkbox" class="js-filter-desktop-second-discipline-checkbox" value="traditional"> Trad<br>
				<input type="checkbox" class="js-filter-desktop-second-discipline-checkbox" value="bouldering"> Bouldering<br>

				<input type="submit" class="js-filter-desktop-submit js-filter-desktop-discipline-submit" value="GO">
			</div>
		</li>

		<li class="sortfilter-bar--months button-filter js-filter-button-dropdown hide-on-mobile">
			Months
			<div class="dropdown-content">
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="january"> January <br>
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="february"> February <br>
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="march"> March <br>
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="april"> April <br>
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="may"> May <br>
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="june"> June <br>
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="july"> July <br>
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="august"> August <br>
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="september"> September <br>
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="october"> October <br>
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="november"> November <br>
				<input type="checkbox" class="js-filter-desktop-months-checkbox" value="december"> December <br>

				<input type="submit" class="js-filter-desktop-submit js-filter-desktop-months-submit" value="GO">
			</div>
		</li>

		<li class="sortfilter-bar--car button-filter js-filter-button-dropdown hide-on-mobile">
			Car
			<div class="dropdown-content">
				<input type="checkbox" class="js-filter-desktop-car-checkbox" value="not_needed"> Not needed <br>
				<input type="checkbox" class="js-filter-desktop-car-checkbox" value="good_to_have"> Good to have <br>
				<input type="checkbox" class="js-filter-desktop-car-checkbox" value="must_have"> Must have <br>

				<input type="submit" class="js-filter-desktop-submit js-filter-car-submit" value="GO">
			</div>
		</li>

		<li class="sortfilter-bar--filters button js-mobile-filters-toggle js-filter-button-dropdown hide-on-desktop">
			<span>Filters</span>
		</li>

		</ul>
	</div>

	<!-- Mobile filters -->
	<div class="mobile-filters-container js-mobile-filters-container">
		<h4>Average weekly cost (EUR)</h4>
		<select name="filter_mobile_cost" class="js-filter-mobile-cost">
    			<option value="any">Any</option>
    			<option value="200">&#60;200 EUR / week</option>
    			<option value="500">&#60;500 EUR / week</option>
    			<option value="1000">&#60;1000 EUR / week</option>
    	</select>

		<h4>Accomodation</h4>
		<input type="checkbox" class="js-filter-mobile-accomodation-checkbox" name="mobile_tent_free" value="tent_free"> <label for="mobile_tent_free">Free tent spots</label> <br>
		<input type="checkbox" class="js-filter-mobile-accomodation-checkbox" name="mobile_van_free" value="van_free"> <label for="mobile_van_free">Free van spots</label> <br>
		<input type="checkbox" class="js-filter-mobile-accomodation-checkbox" name="mobile_cambing" value="camping"> <label for="mobile_camping">Camping</label> <br>
		<input type="checkbox"  class="js-filter-mobile-accomodation-checkbox" name="mobile_hostel_guesthouse" value="hostel"> <label for="mobile_hostel_guesthouse">Hostel/Guesthouse</label> <br>
		<input type="checkbox" class="js-filter-mobile-accomodation-checkbox" name="mobile_apartment" value="apartment"> <label for="mobile_apartment">apartment</label> <br>
		<input type="checkbox" class="js-filter-mobile-accomodation-checkbox" name="mobile_house" value="house"> <label for="mobile_house">House</label> <br>
		<input type="checkbox" class="js-filter-mobile-accomodation-checkbox" name="mobile_hotel" value="hotel"> <label for="mobile_hotel">Hotel</label>

		<h4>Main discipline</h4>
		<select class="filter-main-discipline--select js-filter-mobile-main-discipline">
			<option selected="selected" value="any">Any</option>
			<option value="traditional">Traditional</option>
			<option value="sport">Sport</option>
			<option value="bouldering">Bouldering</option>
		</select>
		
		<h5>Also have</h5>
		<input type="checkbox" class="js-filter-mobile-second-discipline-checkbox" name="mobile_bouldering" value="bouldering"> <label for="mobile_bouldering">Bouldering</label> <br>
		<input type="checkbox" class="js-filter-mobile-second-discipline-checkbox" name="mobile_sport" value="sport"> <label for="mobile_sport">Sport</label> <br>
		<input type="checkbox" class="js-filter-mobile-second-discipline-checkbox" name="mobile_traditional" value="traditional"> <label for="mobile_traditional">Traditional</label> <br>
		
		<h4>Months</h4>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_january" value="january"> <label for="mobile_january">January</label> <br>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_february" value="february"> <label for="mobile_february">February</label> <br>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_mars" value="mars"> <label for="mobile_mars">Mars</label> <br>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_april" value="april"> <label for="mobile_april">April</label> <br>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_may" value="may"> <label for="mobile_may">May</label> <br>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_june" value="june"> <label for="mobile_june">June</label> <br>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_july" value="july"> <label for="mobile_july">July</label> <br>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_august" value="august"> <label for="mobile_august">August</label> <br>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_september" value="september"> <label for="mobile_september">September</label> <br>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_october" value="october"> <label for="mobile_october">October</label> <br>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_november" value="november"> <label for="mobile_november">november</label> <br>
		<input type="checkbox" class="js-filter-mobile-months-checkbox" name="mobile_december" value="december"> <label for="mobile_december">December</label> <br>

		<h4>Car</h4>
		<input type="checkbox" class="js-filter-mobile-car-checkbox" name="mobile_car_not_needed" value="not_needed"> <label for="mobile_car_not_needed">Not Needed</label> <br>
		<input type="checkbox" class="js-filter-mobile-car-checkbox" name="mobile_car_good_to_have" value="good_to_have"> <label for="mobile_car_good_to_have">Good to have</label> <br>
		<input type="checkbox" class="js-filter-mobile-car-checkbox" name="mobile_car_must_have" value="must_have"> <label for="mobile_car_must_have">Must have</label> <br>
		
		<input type="submit" class="filter-mobile-submit js-filter-mobile-submit" value="GO">
		
	</div>

<div class="destinations-list-container">
    	<ul>


{% for destination in destinations %}
	{% set routes = destination.routes.first() %}
	{% set cost = destination.cost.first() %}
	{% set months = destination.months.first() %}
	{% set accomodation = destination.accomodation.first() %}
	{% set car = destination.car.first() %}
	{% set approach = destination.approach.first() %}
	
	{% if routes %}
		{% set max_height = 100 %}

		<!-- Get routes data from database -->
		{% set easy_routes = routes.easy_routes %}
		{% set intermediate_routes = routes.intermediate_routes %}
		{% set hard_routes = routes.hard_routes %}
		{% set very_hard_routes = routes.very_hard_routes %}

		<!-- Set route-ranges to 1 if 0 in database -->
		{% if easy_routes == 0 %}
			{% set easy_routes = 1 %}
		{% endif %}
		{% if intermediate_routes == 0 %}
			{% set intermediate_routes = 1 %}
		{% endif %}
		{% if hard_routes == 0 %}
			{% set hard_routes = 1 %}
		{% endif %}
		{% if very_hard_routes == 0 %}
			{% set very_hard_routes = 1 %}
		{% endif %}
		
		<!-- find which range has the most routes, and set it to most_routes -->
		{% set most_routes = 0 %}

		{% if most_routes < easy_routes %}
			{% set most_routes = easy_routes %}
		{% endif %}
		{% if most_routes < intermediate_routes %}
			{% set most_routes = intermediate_routes %}
		{% endif %}
		{% if most_routes < hard_routes %}
			{% set most_routes = hard_routes %}
		{% endif %}
		{% if most_routes < very_hard_routes %}
			{% set most_routes = very_hard_routes %}
		{% endif %}

		<!-- Calculate percentages for column height -->
		{% set perc_easy_routes = easy_routes / most_routes * 100 %}
		{% set perc_intermediate_routes = intermediate_routes / most_routes * 100 %}
		{% set perc_hard_routes = hard_routes / most_routes * 100 %}
		{% set perc_very_hard_routes = very_hard_routes / most_routes * 100 %}

		<!-- calculate margin-top for each column, to reflect percentage height -->
		{% set margin_easy_routes = 80 - 0.8*perc_easy_routes %}
		{% set margin_intermediate_routes = 80 - 0.8*perc_intermediate_routes %}
		{% set margin_hard_routes = 80 - 0.8*perc_hard_routes %}
		{% set margin_very_hard_routes = 80 - 0.8*perc_very_hard_routes %}
								
	{% endif %}
	<li class="destination-container">
		<a href="/{{ destination.id }}">
			
			<!-- BG - Pos: absolute -->
			<div class="destination-bg" style="background: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0)), url({{ destination.featured_photo_url }}); background-size:cover; background-position: center;">
			</div>

			<!-- Top destination div - with BG -->
			<div class="destination-top">
				
				<!-- Discipline icons at the top -->
				<div class="destination-top__discipline-icons">
					
					<!-- MAIN ICON -->
					{% if routes.main_discipline == "traditional" %}
						<img class="discipline-icons discipline-icons__main" src="{{ url_for('static', filename='images/icon_trad.png') }}" alt="Traditional">
					{% elif routes.main_discipline == "sport" %}
						<img class="discipline-icons discipline-icons__main" src="{{ url_for('static', filename='images/icon_sport.png') }}" alt="Sport">
					{% elif routes.main_discipline == "bouldering" %}
						<img class="discipline-icons discipline-icons__main" src="{{ url_for('static', filename='images/icon_bouldering.png') }}" alt="Bouldering">
					{% endif %}

					<!-- SECONDARY ICON -->
					{% if routes.traditional == 1 and routes.main_discipline != "traditional" %}
						<img class="discipline-icons discipline-icons__secondary" src="{{ url_for('static', filename='images/icon_trad.png') }}" alt="Traditional">
					{% endif %}

					{% if routes.sport == 1 and routes.main_discipline != "sport" %}
						<img class="discipline-icons discipline-icons__secondary" src="{{ url_for('static', filename='images/icon_sport.png') }}" alt="Sport">
					{% endif %}

					{% if routes.bouldering == 1 and routes.main_discipline != "bouldering" %}
						<img class="discipline-icons discipline-icons__secondary" src="{{ url_for('static', filename='images/icon_bouldering.png') }}" alt="Bouldering">
					{% endif %}	
						
				</div>

				<!-- Title and country -->
				<div class="destination-top__title-country">
					<h2>{{ destination.title }}, <span class="destination-country">{{ destination.country }}</span></h2>
				</div>

				<!-- Routes diagram -->
				<div class="destination-top__routes-chart">
					<span class="column">
						<span class="hide-text col-grade-easy" style="height: {{ 0.6*perc_easy_routes }}px; margin-top: {{ margin_easy_routes }}px;">{{ easy_routes }}</span>
						<!-- 2 - 3 -->
					</span>
					<span class="column">
						<span class="hide-text col-grade-intermediate" style="height: {{ 0.6*perc_intermediate_routes }}px; margin-top: {{ margin_intermediate_routes }}px;">{{ intermediate_routes }}</span>
						<!-- 4 -->
					</span>
					<span class="column">
						<span class="hide-text col-grade-hard" style="height: {{ 0.6*perc_hard_routes }}px; margin-top: {{ margin_hard_routes }}px;">{{ hard_routes }}</span>
						<!-- 5 -->
					</span>
					<span class="column">
						<span class="hide-text col-grade-very-hard" style="height: {{ 0.6*perc_very_hard_routes }}px; margin-top: {{ margin_very_hard_routes }}px;">{{ very_hard_routes }}</span>
						<!-- 6 -->
					</span>
					<div class="clearfix"></div>
				</div>
			</div>

			<!-- Hover: display this div on top of "destination-top"  -->
			<div class="destination-display-on-hover invisible">

				<!-- APPROACH -->
				<span class="property-title">Approach</span> 
				{% if approach.easy == 1 %}
					<span class="property-value--approach">Easy</span>
				{% endif %}
				{% if approach.moderate == 1 %}
					<span class="property-value--approach">Moderate</span>
				{% endif %}
				{% if approach.hardcore == 1 %}
					<span class="property-value--approach">Hardcore</span>
				{% endif %}

				<!-- TOTAL ROUTES -->
				<span class="total-all">Total routes: {{ routes.total_routes }}</span>

				<!-- Total Sport -->
				<span class="total-sport">
					<img class="discipline-icons discipline-icons__secondary" src="{{ url_for('static', filename='images/icon_sport.png') }}" alt="Sport"> 
					{{ routes.total_sport }}
				</span>

				<!-- Total Trad -->
				<span class="total-trad">
					<img class="discipline-icons discipline-icons__secondary" src="{{ url_for('static', filename='images/icon_trad.png') }}" alt="Traditional"> 
					{{ routes.total_trad }}
				</span>
				
				<!-- Total Boulders -->
				<span class="total-boulders">
					<img class="discipline-icons discipline-icons__secondary" src="{{ url_for('static', filename='images/icon_bouldering.png') }}" alt="Boulders"> 
					 {{ routes.total_boulders }}
					</span>

			</div>

			<!-- Bottom destination div - specific info with flat bg -->
			<div class="destination-bottom">
				
				<span class="destination-bottom__weekly-cost">
					<span class="property-title">Cost: </span>
					<span class="property-value--cost">
						<span class="money">{{ cost.avg_weekly_cost }}</span> 
						<span class="currency">{{ cost.cost_form_currency }}
						</span> 
					/ w
					</span>
						
					<div class="clearfix"></div>
				</span>
				
				<span class="destination-bottom__season">
					<span class="property-title">Season:</span>
						{% if months.january == 1 %}
							<span class="property-value--month">Jan</span>
						{% endif %}
						{% if months.february == 1 %}
							<span class="property-value--month">Feb</span>
						{% endif %}
						{% if months.mars == 1 %}
							<span class="property-value--month">Mar</span>
						{% endif %}
						{% if months.may == 1 %}
							<span class="property-value--month">May</span>
						{% endif %}
						{% if months.june == 1 %}
							<span class="property-value--month">Jun</span>
						{% endif %}
						{% if months.july == 1 %}
							<span class="property-value--month">Jul</span>
						{% endif %}
						{% if months.august == 1 %}
							<span class="property-value--month">Aug</span>
						{% endif %}
						{% if months.september == 1 %}
							<span class="property-value--month">Sep</span>
						{% endif %}
						{% if months.october == 1 %}
							<span class="property-value--month">Oct</span>
						{% endif %}
						{% if months.november == 1 %}
							<span class="property-value--month">Nov</span>
						{% endif %}
						{% if months.december == 1 %}
							<span class="property-value--month">Dec</span>
						{% endif %}
						
						<div class="clearfix"></div>
				</span>

				<span class="destination-bottom__accomodation">
					<span class="property-title">Accomodation: </span> 
					{% if accomodation.tent == 1 %}
						<span class="property-value--accomodation">Tent</span>
					{% endif %}
					{% if accomodation.van == 1 %}
						<span class="property-value--accomodation">Van</span>
					{% endif %}
					{% if accomodation.hostel == 1 %}
						<span class="property-value--accomodation">Hostel</span>
					{% endif %}
					{% if accomodation.camping == 1 %}
						<span class="property-value--accomodation">Camping</span>
					{% endif %}
					{% if accomodation.apartment == 1 %}
						<span class="property-value--accomodation">Apartment</span>
					{% endif %}
					{% if accomodation.house == 1 %}
						<span class="property-value--accomodation">House</span>
					{% endif %}
					{% if accomodation.hotel == 1 %}
						<span class="property-value--accomodation">Hotel</span>
					{% endif %}
					
					<div class="clearfix"></div>
				</span>

				<span class="destination-bottom__restdays"></span>

				<span class="destination-bottom__car">
					<span class="property-title">Car: </span> 
						{% if car.not_needed == 1 %}
							<span class="property-value--car">Not needed</span>
						{% endif %}
						{% if car.good_to_have == 1 %}
							<span class="property-value--car">Good to have</span>
						{% endif %}
						{% if car.must_have == 1 %}
							<span class="property-value--car">Must have</span>
						{% endif %}
				</span>
			</div>
			{% if current_user.is_authenticated and current_user.access == 2 %}
			<div class="edit-remove">
				<a href="{{ url_for('edit', id=destination.id) }}">Edit</a>
				<a href="{{ url_for('delete', id=destination.id) }}">Delete</a>
			</div>
			{% endif %}
		</a>
	</li>
{% endfor %}
	<div class="clearfix"></div>

	</ul>
</div>
{% endblock %}